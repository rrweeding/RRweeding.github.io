const audio=(()=>{var e=void 0,t=()=>(e||((e=new Audio).autoplay=!0,e.src=document.getElementById("tombol-musik").getAttribute("data-url"),e.load(),e.currentTime=0,e.volume=1,e.muted=!1,e.loop=!0),e);return{play(){t().play()},pause(){t().pause()}}})(),escapeHtml=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),salin=e=>{navigator.clipboard.writeText(e.getAttribute("data-nomer"));let t=e.innerHTML;e.innerHTML="Tersalin",e.disabled=!0,setTimeout(()=>{e.innerHTML=t,e.disabled=!1},1500)},timer=()=>{var e=new Date(document.getElementById("tampilan-waktu").getAttribute("data-waktu").replace(" ","T")).getTime(),t=void 0,a=void 0;t=setInterval(()=>{if((a=e-new Date().getTime())<0){clearInterval(t),t=void 0;return}document.getElementById("hari").innerText=Math.floor(a/864e5),document.getElementById("jam").innerText=Math.floor(a%864e5/36e5),document.getElementById("menit").innerText=Math.floor(a%36e5/6e4),document.getElementById("detik").innerText=Math.floor(a%6e4/1e3)},1e3)},buka=async()=>{document.getElementById("loading").style.display="none",document.getElementById("tombol-musik").style.display="block",audio.play(),AOS.init(),await login(),timer()},play=e=>{"true"!=e.getAttribute("data-status").toString()?(e.setAttribute("data-status","true"),audio.play(),e.innerHTML='<i class="fa-solid fa-circle-pause"></i>'):(e.setAttribute("data-status","false"),audio.pause(),e.innerHTML='<i class="fa-solid fa-circle-play"></i>')},resetForm=()=>{document.getElementById("kirim").style.display="block",document.getElementById("hadiran").style.display="block",document.getElementById("labelhadir").style.display="block",document.getElementById("batal").style.display="none",document.getElementById("kirimbalasan").style.display="none",document.getElementById("idbalasan").value=null,document.getElementById("balasan").innerHTML=null,document.getElementById("formnama").value=null,document.getElementById("hadiran").value=0,document.getElementById("formpesan").value=null},balasan=async e=>{e.disabled=!0;let t=e.innerText;e.innerText="Loading...";let a=e.getAttribute("data-uuid").toString(),n=localStorage.getItem("token")??"";if(0==n.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}let l=document.getElementById("balasan");l.innerHTML=renderLoading(1),document.getElementById("hadiran").style.display="none",document.getElementById("labelhadir").style.display="none";let r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}};await fetch(document.querySelector("body").getAttribute("data-url")+"/api/comment/"+a,r).then(e=>e.json()).then(e=>{if(200==e.code&&(document.getElementById("kirim").style.display="none",document.getElementById("batal").style.display="block",document.getElementById("kirimbalasan").style.display="block",document.getElementById("idbalasan").value=a,l.innerHTML=`
                <div class="card-body bg-light shadow p-3 my-2 rounded-4">
                    <div class="d-flex flex-wrap justify-content-between align-items-center">
                        <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                            <strong>${escapeHtml(e.data.nama)}</strong>
                        </p>
                        <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${e.data.created_at}</small>
                    </div>
                    <hr class="text-dark my-1">
                    <p class="text-dark m-0 p-0" style="white-space: pre-line">${escapeHtml(e.data.komentar)}</p>
                </div>`),0!=e.error.length){if("Expired token"==e.error[0]){alert("Terdapat kesalahan, token expired !"),window.location.reload();return}alert(e.error[0])}}).catch(e=>{resetForm(),alert(e)}),document.getElementById("ucapan").scrollIntoView({behavior:"smooth"}),e.disabled=!1,e.innerText=t},kirimBalasan=async()=>{let e=document.getElementById("formnama").value,t=document.getElementById("formpesan").value,a=localStorage.getItem("token")??"",n=document.getElementById("idbalasan").value;if(0==a.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}if(0==e.length){alert("nama tidak boleh kosong");return}if(e.length>=35){alert("panjangan nama maksimal 35");return}if(0==t.length){alert("pesan tidak boleh kosong");return}document.getElementById("batal").disabled=!0,document.getElementById("kirimbalasan").disabled=!0;let l=document.getElementById("kirimbalasan").innerHTML;document.getElementById("kirimbalasan").innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Loading...';let r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({nama:e,id:n,komentar:t})},i=!1;await fetch(document.querySelector("body").getAttribute("data-url")+"/api/comment",r).then(e=>e.json()).then(e=>{if(201==e.code&&(i=!0),0!=e.error.length){if("Expired token"==e.error[0]){alert("Terdapat kesalahan, token expired !"),window.location.reload();return}alert(e.error[0])}}).catch(e=>{resetForm(),alert(e)}),i&&(await ucapan(),document.getElementById(n).scrollIntoView({behavior:"smooth"}),resetForm()),document.getElementById("batal").disabled=!1,document.getElementById("kirimbalasan").disabled=!1,document.getElementById("kirimbalasan").innerHTML=l},innerCard=e=>{let t="";return e.forEach(e=>{t+=`
        <div class="card-body border-start bg-light py-2 ps-2 pe-0 my-2 ms-2 me-0" id="${e.uuid}">
            <div class="d-flex flex-wrap justify-content-between align-items-center">
                <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                    <strong>${escapeHtml(e.nama)}</strong>
                </p>
                <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
            </div>
            <hr class="text-dark my-1">
            <p class="text-dark mt-0 mb-1 mx-0 p-0" style="white-space: pre-line">${escapeHtml(e.komentar)}</p>
            <button style="font-size: 0.8rem;" onclick="balasan(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-4 py-0">Balas</button>
            ${innerCard(e.comment)}
        </div>`}),t},renderCard=e=>{let t=document.createElement("div");return t.classList.add("mb-3"),t.innerHTML=`
    <div class="card-body bg-light shadow p-3 m-0 rounded-4" id="${e.uuid}">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <p class="text-dark text-truncate m-0 p-0" style="font-size: 0.95rem;">
                <strong class="me-1">${escapeHtml(e.nama)}</strong>${e.hadir?'<i class="fa-solid fa-circle-check text-success"></i>':'<i class="fa-solid fa-circle-xmark text-danger"></i>'}
            </p>
            <small class="text-dark m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="text-dark my-1">
        <p class="text-dark mt-0 mb-1 mx-0 p-0" style="white-space: pre-line">${escapeHtml(e.komentar)}</p>
        <button style="font-size: 0.8rem;" onclick="balasan(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-dark rounded-4 py-0">Balas</button>
        ${innerCard(e.comment)}
    </div>`,t},renderLoading=e=>{let t="";for(let a=0;a<e;a++)t+=`
        <div class="mb-3">
            <div class="card-body bg-light shadow p-3 m-0 rounded-4">
                <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-glow">
                    <span class="placeholder bg-secondary col-5"></span>
                    <span class="placeholder bg-secondary col-3"></span>
                </div>
                <hr class="text-dark my-1">
                <p class="card-text placeholder-glow">
                    <span class="placeholder bg-secondary col-6"></span>
                    <span class="placeholder bg-secondary col-5"></span>
                    <span class="placeholder bg-secondary col-12"></span>
                </p>
            </div>
        </div>`;return t},pagination=(()=>{var e=0,t=0,a=()=>{document.getElementById("previous").classList.add("disabled")},n=()=>{document.getElementById("next").classList.add("disabled")},l=async e=>{let t=e.innerHTML;e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Loading...',await ucapan(),e.disabled=!1,e.innerHTML=t,document.getElementById("daftarucapan").scrollIntoView({behavior:"smooth"})};return{getPer:()=>10,getNext:()=>e,async reset(){e=0,t=0,await ucapan(),document.getElementById("next").classList.remove("disabled"),a()},setResultData(e){(t=e)<10&&n()},async previous(t){e<0?a():(e-=10,n(),await l(t),document.getElementById("next").classList.remove("disabled"),e<=0&&a())},async next(r){t<10?n():(e+=10,a(),await l(r),document.getElementById("previous").classList.remove("disabled"))}}})(),ucapan=async()=>{let e=document.getElementById("daftarucapan");e.innerHTML=renderLoading(pagination.getPer());let t=localStorage.getItem("token")??"";if(0==t.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}let a={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}};await fetch(document.querySelector("body").getAttribute("data-url")+`/api/comment?per=${pagination.getPer()}&next=${pagination.getNext()}`,a).then(e=>e.json()).then(t=>{if(200==t.code&&(e.innerHTML=null,t.data.forEach(t=>e.appendChild(renderCard(t))),pagination.setResultData(t.data.length),0==t.data.length&&(e.innerHTML='<div class="h6 text-center">Tidak ada data</div>')),0!=t.error.length){if("Expired token"==t.error[0]){alert("Terdapat kesalahan, token expired !"),window.location.reload();return}alert(t.error[0])}}).catch(e=>alert(e))},login=async()=>{document.getElementById("daftarucapan").innerHTML=renderLoading(pagination.getPer());let e=document.querySelector("body"),t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:e.getAttribute("data-email").toString(),password:e.getAttribute("data-password").toString()})};await fetch(e.getAttribute("data-url")+"/api/login",t).then(e=>e.json()).then(e=>{if(200==e.code&&(localStorage.removeItem("token"),localStorage.setItem("token",e.data.token),ucapan()),0!=e.error.length){alert("Terdapat kesalahan, "+e.error[0]),window.location.reload();return}}).catch(()=>{alert("Terdapat kesalahan, "+res.error[0]),window.location.reload()})},kirim=async()=>{let e=document.getElementById("formnama").value,t=document.getElementById("hadiran").value,a=document.getElementById("formpesan").value,n=localStorage.getItem("token")??"";if(0==n.length){alert("Terdapat kesalahan, token kosong !"),window.location.reload();return}if(0==e.length){alert("nama tidak boleh kosong");return}if(e.length>=35){alert("panjangan nama maksimal 35");return}if(0==t){alert("silahkan pilih kehadiran");return}if(0==a.length){alert("pesan tidak boleh kosong");return}document.getElementById("kirim").disabled=!0;let l=document.getElementById("kirim").innerHTML;document.getElementById("kirim").innerHTML='<span class="spinner-border spinner-border-sm me-1"></span>Loading...';let r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({nama:e,hadir:1==t,komentar:a})};await fetch(document.querySelector("body").getAttribute("data-url")+"/api/comment",r).then(e=>e.json()).then(e=>{if(201==e.code&&(resetForm(),pagination.reset()),0!=e.error.length){if("Expired token"==e.error[0]){alert("Terdapat kesalahan, token expired !"),window.location.reload();return}alert(e.error[0])}}).catch(e=>{resetForm(),alert(e)}),document.getElementById("kirim").disabled=!1,document.getElementById("kirim").innerHTML=l};window.addEventListener("load",()=>{let e=new bootstrap.Modal("#exampleModal"),t=new URLSearchParams(window.location.search).get("to")??"";if(0==t.length)document.getElementById("namatamu").remove();else{let a=document.createElement("div");a.classList.add("mt-2"),a.innerHTML=`
        <div class="text-center mt-3">
        <span style="font-size:1.2em; font-family:'SweetRomance'; color:black; letter-spacing:.2em; margin-left:1em":>Dear</span>
        </div>
        <h2 class="text-dark mt-2" style="font-size:1.2em !important; font-family:'sunflower'">${escapeHtml(t)}</h2>
        `,document.getElementById("formnama").value=t,document.getElementById("namatamu").appendChild(a)}e.show()},!1);